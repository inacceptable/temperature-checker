<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	{% load static %} 
	<title>Weather</title>
	<link rel='stylesheet' type='text/css' href="{% static 'css/style.css' %}"/>  
	<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"></script>

    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDiCuvckq4Wcds6s85xqXsZZopnT4ch4Bw&libraries=places"></script>
</head>
<body>	
	<div class='weather-container'>
		
		<div class='search'> 
			<div ><input id="searchTextField" type="text" size="50"></div>
			<div><button id='search-button'>Search</button></div>
			<div class='hidden'>
				<div ><input type='text' id='city2'  placeholder='city'></div>
				<div><input type='text' id="cityLat" placeholder='postcode'></div>
				<div><input type='text' id="cityLng" placeholder='country'></div>
			</div>
		</div>
	
		<script type="text/javascript">
    function initialize() {
        var input = document.getElementById('searchTextField');
        var autocomplete = new google.maps.places.Autocomplete(input);
        google.maps.event.addListener(autocomplete, 'place_changed', function () {
            var place = autocomplete.getPlace();
            document.getElementById('city2').value = place.name;
            document.getElementById('cityLat').value = place.geometry.location.lat();
            document.getElementById('cityLng').value = place.geometry.location.lng();

            //alert("This function is working!");
            //alert(place.name);
           // alert(place.address_components[0].long_name);

        });
    }
    google.maps.event.addDomListener(window, 'load', initialize); 
</script>
		<div class='display-temperature'>
			<div class='temperature-details'> 
				<h1 id='display-name'>{{apidata.name}}</h1>
				<h2 id='display-current'>Current: {{apidata.main.temp}}</h2>
				<h2 id='display-min'>Min: {{apidata.main.temp_min}}</h2>
				<h2 id='display-max'>Max: {{apidata.main.temp_max}}</h2>
			</div>
			<div class='temperature-animations'>
				{% for i in apidata.weather %}
				<marquee><h3 id='display-description'>Today we have, {{i.description}}</h3>
				<img id="display-icon" src='http://openweathermap.org/img/wn/{{i.icon}}@4x.png' alt=""/></marquee>
				{% endfor %}
			</div>
			<script type="text/javascript">
			$("#search-button").click(function() {
			            var city2 = $('#city2').val();
			            var cityLat = $('#cityLat').val();
			            var cityLng = $('#cityLng').val();
			            
			            $.ajax({
			                type: 'GET',
			                url: "{% url 'search' %}",
			                data: {
			                    'city': city2,
			                    'postcode': cityLat,
			                    'country' : cityLng,
			                },
			                success: function(data) {
			                	var description = data.apidata.weather[0].description; 
			                	var current_temp = data.apidata.main.temp;
			                	var temp_min = data.apidata.main.temp_min;
			                	var temp_max = data.apidata.main.temp_max;
			                	var icon = data.apidata.weather[0].icon;
			                	var place = data.apidata.name;
			                	$('#display-name').text(city2);
			                	$('#display-current').text("Current: " + current_temp);
			                	$('#display-min').text("Min: " + temp_min);
			                	$('#display-max').text("Max: " + temp_max);
			                	$('#display-description').text("Today we have, " + description);
			                	var new_link = "http://openweathermap.org/img/wn/" + icon + "@4x.png"
			                	$("#display-icon").attr("src", new_link);
			                }
			            });
			        });
			</script>
		</div> 
		
	</div>

</body>
</html>